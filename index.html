<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Le Coeur du Dragon</title>
    <link rel="stylesheet" href="style.css">
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#8B4513">
    <meta name="description" content="Une quÃªte lÃ©gendaire de courage et d'honneur inspirÃ©e par Legend of the Red Dragon">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="Coeur du Dragon">
</head>
<body>
    <div class="game-container">
        <div class="game-header">
            <h1>âš”ï¸ Le Coeur du Dragon âš”ï¸</h1>
            <div class="subtitle">Une quÃªte lÃ©gendaire de courage et d'honneur</div>
            <button id="audioToggle" class="audio-toggle" onclick="toggleAudio()" title="Activer/DÃ©sactiver le son">
                ğŸ”Š
            </button>
        </div>

        <div class="game-stats" id="gameStats" style="display: none;">
            <!-- Groupe 1: Informations personnelles (Nom, Classe, Race, Sexe) - Clickable -->
            <div class="stat-box stat-group-character" onclick="toggleEquipmentModal()" style="cursor: pointer;" title="Cliquer pour voir l'Ã©quipement">
                <div class="stat-label">Personnage ğŸ”</div>
                <div class="character-info-compact">
                    <div><strong id="playerName">---</strong></div>
                    <div style="font-size: 0.85em;"><span id="playerClass">âš”ï¸ Guerrier</span> | <span id="playerRace">ğŸ‘¤ Humain</span></div>
                    <div style="font-size: 0.85em;" id="playerGender">â™‚ï¸ Masculin</div>
                    <div style="font-size: 0.85em; margin-top: 5px; display: flex; align-items: center; gap: 5px;">
                        <div class="char-compact" onclick="event.stopPropagation(); toggleInventoryPanel()" style="cursor: pointer; display: inline-flex; align-items: center; gap: 3px; padding: 3px 6px; background: rgba(0,0,0,0.3); border-radius: 3px;" title="Ouvrir/Fermer le sac">
                            <span class="char-label-small">ğŸ’</span>
                            <span class="char-value-small" id="inventoryCount">0/4</span>
                        </div>
                    </div>
                </div>
                <div id="inventoryPanel" style="display: none; margin-top: 8px; padding: 8px; background: rgba(0,0,0,0.3); border-radius: 5px;">
                    <div style="color: #DAA520; font-weight: bold; margin-bottom: 6px; font-size: 0.9em;">ğŸ’ Sac d'Objets</div>
                    <div id="inventoryPanelContent"></div>
                </div>
            </div>

            <!-- Groupe 2: Statistiques de combat (PV, Mana for mages, CA, Ã‰nergie) -->
            <div class="stat-box stat-group-combat">
                <div class="stat-label">Combat</div>
                <div class="combat-stats-compact">
                    <div class="combat-stat-row">
                        <span class="combat-icon-small">â¤ï¸</span>
                        <span class="stat-value-small" id="playerHealth">100/100</span>
                        <div class="health-bar-small">
                            <div class="health-fill" id="healthFill" style="width: 100%;"></div>
                        </div>
                    </div>
                    <div class="combat-stat-row" id="manaRow" style="display: none;">
                        <span class="combat-icon-small">ğŸ”®</span>
                        <span class="stat-value-small" id="playerMana">100/100</span>
                        <div class="health-bar-small">
                            <div class="health-fill" id="manaFill" style="width: 100%; background: linear-gradient(90deg, #4169E1 0%, #1E90FF 100%);"></div>
                        </div>
                    </div>
                    <div class="combat-stat-row">
                        <span class="combat-icon-small">âš¡</span>
                        <span class="stat-value-small" id="playerEnergy">100/100</span>
                        <div class="health-bar-small">
                            <div class="health-fill" id="energyFill" style="width: 100%; background: linear-gradient(90deg, #FFD700 0%, #FFA500 100%);"></div>
                        </div>
                    </div>
                    <div class="combat-stat-inline">
                        <span class="combat-icon-small" id="weaponIcon">âš”ï¸</span>
                        <span class="stat-label-inline">Arme:</span>
                        <span class="stat-value-small" id="playerWeaponDamage">0</span>
                    </div>
                    <div class="combat-stat-inline">
                        <span class="combat-icon-small">ğŸ›¡ï¸</span>
                        <span class="stat-label-inline">CA:</span>
                        <span class="stat-value-small" id="playerDefense">5</span>
                    </div>
                </div>
            </div>

            <!-- Groupe 3: Progression et CaractÃ©ristiques combinÃ©es -->
            <div class="stat-box stat-group-progression-combined">
                <div class="stat-label">Progression & Stats</div>
                <div class="progression-compact">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
                        <span style="font-size: 0.85em;">Niv. <strong id="playerLevel">1</strong></span>
                        <span style="font-size: 0.85em;" id="playerXP">0/100</span>
                        <span style="font-size: 0.85em;" id="playerGold">0 ğŸ’°</span>
                    </div>
                    <div class="xp-bar">
                        <div class="xp-fill" id="xpFill" style="width: 0%;"></div>
                    </div>
                    <div id="statPointsAvailable" style="display: none; text-align: center; margin: 5px 0; font-size: 0.85em; color: #DAA520; font-weight: bold;">
                        âœ¨ Points disponibles: <span id="statPointsCount">0</span>
                    </div>
                    <div class="characteristics-grid-compact">
                        <div class="char-compact clickable-stat" onclick="spendStatPoint('strength')" title="Cliquer pour ajouter +1">
                            <span class="char-label-small">FOR</span>
                            <span class="char-value-small" id="playerStrength">10</span>
                        </div>
                        <div class="char-compact clickable-stat" onclick="spendStatPoint('dexterity')" title="Cliquer pour ajouter +1">
                            <span class="char-label-small">DEX</span>
                            <span class="char-value-small" id="playerDexterity">10</span>
                        </div>
                        <div class="char-compact clickable-stat" onclick="spendStatPoint('constitution')" title="Cliquer pour ajouter +1">
                            <span class="char-label-small">CON</span>
                            <span class="char-value-small" id="playerConstitution">10</span>
                        </div>
                        <div class="char-compact clickable-stat" onclick="spendStatPoint('intelligence')" title="Cliquer pour ajouter +1">
                            <span class="char-label-small">INT</span>
                            <span class="char-value-small" id="playerIntelligence">10</span>
                        </div>
                        <div class="char-compact clickable-stat" onclick="spendStatPoint('wisdom')" title="Cliquer pour ajouter +1">
                            <span class="char-label-small">SAG</span>
                            <span class="char-value-small" id="playerWisdom">10</span>
                        </div>
                        <div class="char-compact clickable-stat" onclick="spendStatPoint('charisma')" title="Cliquer pour ajouter +1">
                            <span class="char-label-small">CHA</span>
                            <span class="char-value-small" id="playerCharisma">10</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Equipment Modal -->
        <div id="equipmentModal" class="modal" style="display: none;">
            <div class="modal-content">
                <span class="modal-close" onclick="toggleEquipmentModal()">&times;</span>
                <h2 style="color: #DAA520; margin-bottom: 15px;">âš”ï¸ Ã‰quipement</h2>
                <div style="display: flex; gap: 20px; align-items: center;">
                    <div style="font-size: 4em; text-align: center;" id="characterAvatar">ğŸ§™</div>
                    <div style="flex: 1;">
                        <div class="equipment-item">
                            <div class="equipment-icon" id="equippedWeaponIcon">âš”ï¸</div>
                            <div class="equipment-details">
                                <div style="font-weight: bold; color: #DAA520;">Arme</div>
                                <div id="equippedWeaponName">Aucune arme</div>
                                <div id="equippedWeaponDesc" style="font-size: 0.85em; color: #999;"></div>
                            </div>
                        </div>
                        <div class="equipment-item">
                            <div class="equipment-icon">ğŸ›¡ï¸</div>
                            <div class="equipment-details">
                                <div style="font-weight: bold; color: #DAA520;">Armure</div>
                                <div id="equippedArmorName">Aucune armure</div>
                                <div id="equippedArmorDesc" style="font-size: 0.85em; color: #999;"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="game-content">
            <!-- Start Screen -->
            <div id="startScreen" class="game-screen active">
                <div class="story-text">
                    <p>Bienvenue, brave aventurier !</p>
                    <p>Dans le royaume oubliÃ© de Valoria, les tÃ©nÃ¨bres s'Ã©tendent. Au coeur du donjon ancien se cache un artefact lÃ©gendaire - le Coeur du Dragon - capable de sauver le royaume.</p>
                    <p>Les lÃ©gendes racontent que seul un hÃ©ros courageux peut affronter les dangers qui gardent ce trÃ©sor mystique...</p>
                    <p>ÃŠtes-vous prÃªt Ã  devenir cette lÃ©gende ?</p>
                </div>
                <div>
                    <label for="nameInput" style="display: block; margin-bottom: 10px;">Entrez votre nom :</label>
                    <input type="text" id="nameInput" placeholder="Nom du hÃ©ros" maxlength="20">
                </div>
                <div style="margin: 20px 0;">
                    <label style="display: block; margin-bottom: 10px; font-weight: bold;">Genre :</label>
                    <div style="display: flex; gap: 20px;">
                        <label class="class-option" style="flex: 1;">
                            <input type="radio" name="characterGender" value="male" checked>
                            <span class="class-label">
                                <strong>â™‚ï¸ Masculin</strong>
                            </span>
                        </label>
                        <label class="class-option" style="flex: 1;">
                            <input type="radio" name="characterGender" value="female">
                            <span class="class-label">
                                <strong>â™€ï¸ FÃ©minin</strong>
                            </span>
                        </label>
                    </div>
                </div>
                <div style="margin: 20px 0;">
                    <label style="display: block; margin-bottom: 10px; font-weight: bold;">Race :</label>
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px;">
                        <label class="class-option">
                            <input type="radio" name="characterRace" value="humain" checked>
                            <span class="class-label">
                                <strong>ğŸ‘¤ Humain</strong><br>
                                <small style="color: #999;">Ã‰quilibrÃ©</small>
                            </span>
                        </label>
                        <label class="class-option">
                            <input type="radio" name="characterRace" value="elfe">
                            <span class="class-label">
                                <strong>ğŸ§ Elfe</strong><br>
                                <small>DEX +2, CON -2</small>
                            </span>
                        </label>
                        <label class="class-option">
                            <input type="radio" name="characterRace" value="nain">
                            <span class="class-label">
                                <strong>ğŸ§” Nain</strong><br>
                                <small>DEX -2, CON +2</small>
                            </span>
                        </label>
                    </div>
                </div>
                <div style="margin: 20px 0;">
                    <label style="display: block; margin-bottom: 10px; font-weight: bold;">Choisissez votre classe :</label>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                        <label class="class-option">
                            <input type="radio" name="characterClass" value="guerrier" checked>
                            <span class="class-label">
                                <strong>âš”ï¸ Guerrier</strong><br>
                                <small>PV: 120 | FOR: 12 | CA: 9</small><br>
                                <small style="color: #999;">Robuste et rÃ©sistant</small>
                            </span>
                        </label>
                        <label class="class-option">
                            <input type="radio" name="characterClass" value="magicien">
                            <span class="class-label">
                                <strong>ğŸ§™ Magicien</strong><br>
                                <small>PV: 84 | FOR: 15 | CA: 3</small><br>
                                <small style="color: #999;">Puissant mais fragile</small>
                            </span>
                        </label>
                        <label class="class-option">
                            <input type="radio" name="characterClass" value="archer">
                            <span class="class-label">
                                <strong>ğŸ¹ Archer</strong><br>
                                <small>PV: 100 | FOR: 13 | CA: 6</small><br>
                                <small style="color: #999;">Ã‰quilibrÃ© et prÃ©cis</small>
                            </span>
                        </label>

                    </div>
                </div>
                <div class="game-actions">
                    <button onclick="startGame()">ğŸ—¡ï¸ Commencer l'Aventure</button>
                    <button onclick="restoreSaveFromStart()" id="restoreSaveBtn" style="display: none;">ğŸ“¥ Restaurer une Partie</button>
                </div>
            </div>

            <!-- Main Game Screen -->
            <div id="mainScreen" class="game-screen">
                <div class="story-text">
                    <p>Vous vous tenez devant l'entrÃ©e du donjon. Les torches vacillent sur les murs de pierre ancienne. Que souhaitez-vous faire ?</p>
                </div>
                <div class="game-actions-grid">
                    <div class="actions-column">
                        <div class="actions-column-title">ğŸ® Actions de Jeu</div>
                        <button onclick="explore()">ğŸ—ºï¸ Explorer le Donjon (1)</button>
                        <button onclick="meetNPC()">ğŸ’¬ Rencontrer un PNJ (2)</button>
                        <button onclick="showShop()">ğŸª Visiter le Marchand (3)</button>
                        <button onclick="rest()">ğŸ›Œ Dormir Ã  l'Auberge (4)</button>
                    </div>
                    <div class="actions-column">
                        <div class="actions-column-title">ğŸ“Š Informations</div>
                        <button onclick="showStats()">ğŸ“Š Voir Statistiques (5)</button>
                        <button onclick="showLeaderboard()">ğŸ† Classement (6)</button>
                        <button onclick="showDailyQuests()">ğŸ“œ DÃ©fis Quotidiens (7)</button>
                        <button onclick="showAchievements()">ğŸ… SuccÃ¨s (8)</button>
                    </div>
                </div>
            </div>

            <!-- Combat Screen -->
            <div id="combatScreen" class="game-screen">
                <div class="enemy-info" id="enemyInfo">
                    <div class="enemy-icon-container">
                        <div class="enemy-icon" id="enemyIcon">ğŸ‘¹</div>
                    </div>
                    <div class="enemy-details">
                        <h3 id="enemyName">Ennemi</h3>
                        <div class="stat-value" id="enemyHealth">HP: 50/50</div>
                        <div class="stat-value" id="enemyArmor" style="margin-top: 5px; color: #DAA520;">CA: 5 (+0)</div>
                        <div class="health-bar">
                            <div class="health-fill" id="enemyHealthFill" style="width: 100%;"></div>
                        </div>
                    </div>
                </div>
                <div class="combat-log" id="combatLog"></div>
                <div style="display: flex; gap: 15px; margin: 15px 0; flex-wrap: wrap;">
                    <div id="skillsContainer" style="flex: 1; min-width: 200px;"></div>
                    <div id="combatInventoryContainer" style="flex: 1; min-width: 200px;"></div>
                </div>
                <div class="game-actions">
                    <button onclick="attack()">âš”ï¸ Attaquer (A)</button>
                    <button onclick="defend()">ğŸ›¡ï¸ DÃ©fendre (D)</button>
                    <button onclick="flee()">ğŸƒ Fuir (F)</button>
                </div>
            </div>

            <!-- Shop Screen -->
            <div id="shopScreen" class="game-screen">
                <div class="story-text">
                    <p>Un vieux marchand vous accueille avec un sourire Ã©dentÃ©. "Bienvenue dans ma modeste Ã©choppe ! Jetez un oeil Ã  mes marchandises..."</p>
                </div>
                <div id="shopItems"></div>
                <div id="shopInventoryContainer" style="margin-top: 20px;"></div>
                <div class="game-actions">
                    <button onclick="showMain()">ğŸšª Retour (ESC)</button>
                </div>
            </div>

            <!-- Stats Screen -->
            <div id="statsScreen" class="game-screen">
                <div class="story-text">
                    <h3>ğŸ“Š Statistiques du HÃ©ros</h3>
                    <div id="detailedStats"></div>
                </div>
                <div class="game-actions">
                    <button onclick="showMain()">ğŸšª Retour (ESC)</button>
                    <button onclick="showSaveOptions()">ğŸ’¾ Sauvegardes</button>
                    <button onclick="resetGame()" style="background: linear-gradient(135deg, #8B0000 0%, #660000 100%);">ğŸ”„ Nouvelle Partie</button>
                </div>
            </div>

            <!-- Save Options Screen -->
            <div id="saveOptionsScreen" class="game-screen">
                <div class="story-text">
                    <h3>ğŸ’¾ Gestion des Sauvegardes</h3>
                    <p>Votre partie est automatiquement sauvegardÃ©e dans votre navigateur. Utilisez les options ci-dessous pour gÃ©rer vos sauvegardes :</p>
                    
                    <div class="shop-item" style="display: block; margin-top: 20px;">
                        <h4 style="color: #DAA520;">ğŸ“¤ Exporter la Sauvegarde</h4>
                        <p>Obtenez un code de sauvegarde que vous pouvez copier et utiliser sur n'importe quel appareil.</p>
                        <button onclick="exportSave()" style="margin-top: 10px;">GÃ©nÃ©rer le Code</button>
                        <div id="exportResult" style="margin-top: 10px;"></div>
                    </div>
                    
                    <div class="shop-item" style="display: block; margin-top: 20px;">
                        <h4 style="color: #DAA520;">ğŸ“¥ Importer une Sauvegarde</h4>
                        <p>Entrez un code de sauvegarde pour restaurer votre progression.</p>
                        <input type="text" id="importCode" placeholder="Collez votre code ici" style="width: 100%; max-width: 100%;">
                        <button onclick="importSave()" style="margin-top: 10px;">Restaurer</button>
                        <div id="importResult" style="margin-top: 10px;"></div>
                    </div>
                    
                    <div class="shop-item" style="display: block; margin-top: 20px;">
                        <h4 style="color: #DAA520;">â˜ï¸ Sauvegarde Automatique</h4>
                        <p>Statut: <span id="autoSaveStatus" style="color: #51cf66;">âœ“ Active</span></p>
                        <p style="font-size: 0.9em; color: #999;">Les sauvegardes sont automatiquement enregistrÃ©es dans votre navigateur aprÃ¨s chaque action.</p>
                    </div>
                </div>
                <div class="game-actions">
                    <button onclick="showStats()">ğŸšª Retour (ESC)</button>
                    <button onclick="showMultiplayerSettings()">ğŸŒ ParamÃ¨tres Multijoueur</button>
                </div>
            </div>

            <!-- Multiplayer Settings Screen -->
            <div id="multiplayerSettingsScreen" class="game-screen">
                <div class="story-text">
                    <h3>ğŸŒ ParamÃ¨tres Multijoueur LAN</h3>
                    <p>Configurez le serveur multijoueur pour jouer avec votre famille sur le rÃ©seau local.</p>
                    
                    <div class="shop-item" style="display: block; margin-top: 20px;">
                        <h4 style="color: #DAA520;">ğŸ”§ Configuration du Serveur</h4>
                        <p>Entrez l'adresse IP et le port du serveur (ex: 192.168.1.100:3000)</p>
                        <input type="text" id="serverUrlInput" placeholder="192.168.1.100:3000" style="width: 100%; max-width: 100%; margin-top: 10px;">
                        <div style="display: flex; gap: 10px; margin-top: 10px;">
                            <button onclick="saveServerConfig()" style="flex: 1;">ğŸ’¾ Sauvegarder</button>
                            <button onclick="testServerConnection()" style="flex: 1;">ğŸ” Tester</button>
                            <button onclick="disableMultiplayer()" style="flex: 1; background: linear-gradient(135deg, #8B0000 0%, #660000 100%);">âŒ DÃ©sactiver</button>
                        </div>
                        <div id="serverConfigResult" style="margin-top: 10px;"></div>
                    </div>
                    
                    <div class="shop-item" style="display: block; margin-top: 20px;">
                        <h4 style="color: #DAA520;">â„¹ï¸ Informations</h4>
                        <p><strong>ID Joueur:</strong> <span id="playerIdDisplay" style="color: #DAA520; font-family: monospace; font-size: 0.9em;">---</span></p>
                        <p id="multiplayerStatus" style="margin-top: 10px;">âšª Mode solo (aucun serveur configurÃ©)</p>
                    </div>
                    
                    <div class="shop-item" style="display: block; margin-top: 20px;">
                        <h4 style="color: #DAA520;">ğŸ“– Instructions</h4>
                        <ol style="font-size: 0.9em; color: #ddd; text-align: left;">
                            <li>DÃ©marrez le serveur sur un PC du rÃ©seau local (voir server/README.md)</li>
                            <li>Trouvez l'adresse IP du serveur avec <code>ipconfig</code> (Windows) ou <code>ifconfig</code> (Mac/Linux)</li>
                            <li>Entrez l'adresse IP et le port ci-dessus</li>
                            <li>Testez la connexion</li>
                            <li>Vos scores seront automatiquement envoyÃ©s au serveur !</li>
                        </ol>
                    </div>
                </div>
                <div class="game-actions">
                    <button onclick="showSaveOptions()">ğŸšª Retour (ESC)</button>
                </div>
            </div>

            <!-- NPC Screen -->
            <div id="npcScreen" class="game-screen">
                <div class="event-info" id="eventInfo" style="display: none;">
                    <div class="event-icon-container">
                        <div class="event-icon" id="eventIcon">ğŸ‘¹</div>
                    </div>
                    <div class="event-details">
                        <h3 id="eventName">Ã‰vÃ©nement</h3>
                        <div id="eventDescription"></div>
                    </div>
                </div>
                <div class="story-text" id="npcContent">
                    <h3 id="npcName">PNJ</h3>
                    <div id="npcDialogue"></div>
                </div>
                <div class="game-actions">
                    <button onclick="showMain()">ğŸšª Retour (ESC)</button>
                </div>
            </div>

            <!-- Leaderboard Screen -->
            <div id="leaderboardScreen" class="game-screen">
                <div class="story-text">
                    <h3>ğŸ† Classement des HÃ©ros</h3>
                    <p>Les plus grands hÃ©ros du royaume de Valoria :</p>
                    <div id="leaderboardList"></div>
                </div>
                <div class="game-actions">
                    <button onclick="showMain()">ğŸšª Retour (ESC)</button>
                </div>
            </div>

            <!-- Achievements Screen -->
            <div id="achievementsScreen" class="game-screen">
                <div class="story-text">
                    <h3>ğŸ… SuccÃ¨s et Accomplissements</h3>
                    <p>DÃ©bloquez des succÃ¨s pour gagner des rÃ©compenses permanentes !</p>
                    <div id="achievementsContainer" style="max-height: 500px; overflow-y: auto;"></div>
                </div>
                <div class="game-actions">
                    <button onclick="showMain()">ğŸšª Retour (ESC)</button>
                </div>
            </div>

            <!-- Balance Test Screen -->
            <div id="balanceTestScreen" class="game-screen">
                <div class="story-text">
                    <h3>ğŸ§ª Test d'Ã‰quilibre du Jeu</h3>
                    <p>Simulez 100 parties par combinaison de classe, race et sexe (2 400 parties au total) pour analyser l'Ã©quilibre du jeu.</p>
                    <div id="balanceTestControls" style="margin: 20px 0;">
                        <button onclick="runBalanceTest()" id="startBalanceTestBtn" style="font-size: 1.1em; padding: 15px 30px;">
                            ğŸ§ª Lancer le Test d'Ã‰quilibre (100 parties Ã— 24 combinaisons = 2 400 parties)
                        </button>
                        <div id="balanceTestProgress" style="display: none; margin-top: 15px; padding: 15px; background: rgba(0,0,0,0.3); border-radius: 5px;">
                            <p id="balanceTestStatus">PrÃ©paration...</p>
                            <div class="health-bar" style="height: 25px; margin-top: 10px;">
                                <div class="health-fill" id="balanceTestProgressBar" style="width: 0%; background: linear-gradient(90deg, #51cf66 0%, #2ecc71 100%);"></div>
                            </div>
                        </div>
                    </div>
                    <div id="balanceTestResults" style="margin-top: 20px;"></div>
                </div>
                <div class="game-actions">
                    <button onclick="showAdminPanel()">ğŸšª Retour (ESC)</button>
                </div>
            </div>

            <!-- Admin Panel Screen -->
            <div id="adminPanelScreen" class="game-screen">
                <div class="story-text">
                    <h3>ğŸ” Panneau d'Administration</h3>
                    <p>Section rÃ©servÃ©e aux administrateurs du jeu.</p>
                    
                    <div class="game-actions-grid" style="margin-top: 20px;">
                        <div class="actions-column">
                            <div class="actions-column-title">ğŸ§ª Outils de Test</div>
                            <button onclick="showBalanceTest()">ğŸ§ª Test d'Ã‰quilibre</button>
                        </div>
                        <div class="actions-column">
                            <div class="actions-column-title">ğŸ–¥ï¸ Serveur</div>
                            <button onclick="showServerHosting()">ğŸ–¥ï¸ HÃ©bergement Serveur</button>
                        </div>
                    </div>
                </div>
                <div class="game-actions">
                    <button onclick="showMain()">ğŸšª Retour au Jeu</button>
                </div>
            </div>

            <!-- Server Hosting Screen -->
            <div id="serverHostingScreen" class="game-screen">
                <div class="story-text">
                    <h3>ğŸ–¥ï¸ HÃ©bergement du Serveur Multijoueur</h3>
                    <p>Informations et outils pour hÃ©berger le serveur de jeu multijoueur.</p>
                    
                    <div class="shop-item" style="display: block; margin-top: 20px; background: linear-gradient(135deg, #2d5016 0%, #1a3009 100%); border: 2px solid #4a7c1b; padding: 20px;">
                        <h4 style="color: #90EE90; margin-bottom: 15px;">ğŸªŸ DÃ©marrage sur Windows - C'est Simple !</h4>
                        <p style="font-size: 1.1em; color: #fff; font-weight: bold; margin-bottom: 20px;">
                            âœ… OUI, vous pouvez crÃ©er votre serveur facilement !
                        </p>
                        <div style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 5px; margin-bottom: 15px;">
                            <p style="color: #DAA520; font-size: 1em; margin-bottom: 10px;">
                                <strong>ğŸ“ Ã‰tapes simples :</strong>
                            </p>
                            <ol style="font-size: 0.95em; color: #ddd; text-align: left; line-height: 1.8;">
                                <li>Ouvrez l'explorateur de fichiers Windows</li>
                                <li>Naviguez vers le dossier <code style="background: #000; padding: 2px 6px; border-radius: 3px;">server/</code> du projet</li>
                                <li>Trouvez le fichier <code style="background: #000; padding: 2px 6px; border-radius: 3px;">start-server.bat</code></li>
                                <li><strong style="color: #90EE90;">Double-cliquez sur start-server.bat</strong> ğŸ–±ï¸</li>
                                <li>C'est tout ! Le serveur va dÃ©marrer automatiquement ğŸš€</li>
                            </ol>
                        </div>
                        <div style="background: rgba(255,215,0,0.1); padding: 12px; border-radius: 5px; border-left: 4px solid #DAA520;">
                            <p style="font-size: 0.9em; color: #ffd93d; margin: 0;">
                                ğŸ’¡ <strong>Astuce :</strong> Le script installera automatiquement les dÃ©pendances et affichera les adresses IP pour partager avec votre famille !
                            </p>
                        </div>
                    </div>
                    
                    <div class="shop-item" style="display: block; margin-top: 20px;">
                        <h4 style="color: #DAA520;">â“ Pourquoi pas un bouton dans le navigateur ?</h4>
                        <p style="font-size: 0.9em; color: #ddd; line-height: 1.6;">
                            Pour des raisons de sÃ©curitÃ©, les navigateurs web <strong>ne peuvent pas</strong> dÃ©marrer automatiquement des programmes sur votre ordinateur. C'est une protection importante contre les sites malveillants.
                        </p>
                        <p style="font-size: 0.9em; color: #ddd; line-height: 1.6;">
                            C'est pourquoi vous devez double-cliquer sur le fichier <code>start-server.bat</code> manuellement. C'est rapide et sÃ©curitaire ! ğŸ”’
                        </p>
                    </div>
                    
                    <div class="shop-item" style="display: block; margin-top: 20px;">
                        <h4 style="color: #DAA520;">ğŸ“‹ MÃ©thode Alternative (Ligne de Commande)</h4>
                        <p style="font-size: 0.9em; color: #ddd;">Si vous prÃ©fÃ©rez utiliser la ligne de commande :</p>
                        <ol style="font-size: 0.9em; color: #ddd; text-align: left; line-height: 1.6;">
                            <li>Ouvrez l'invite de commande (CMD) ou PowerShell</li>
                            <li>Naviguez vers le dossier <code>server/</code> du projet</li>
                            <li>ExÃ©cutez <code>npm install</code> (premiÃ¨re fois seulement)</li>
                            <li>ExÃ©cutez <code>npm start</code> pour dÃ©marrer le serveur</li>
                        </ol>
                    </div>
                    
                    <div class="shop-item" style="display: block; margin-top: 20px;">
                        <h4 style="color: #DAA520;">ğŸ”§ Configuration</h4>
                        <p><strong>Port par dÃ©faut:</strong> 3000</p>
                        <p><strong>Fichier de configuration:</strong> server/server.js</p>
                        <p><strong>Base de donnÃ©es:</strong> SQLite (server/leaderboard.db)</p>
                    </div>
                    
                    <div class="shop-item" style="display: block; margin-top: 20px;">
                        <h4 style="color: #DAA520;">ğŸ“¡ Ã‰tat du Serveur</h4>
                        <p id="serverStatusInfo" style="color: #999;">VÃ©rifier dans les paramÃ¨tres multijoueur pour tester la connexion au serveur.</p>
                    </div>
                    
                    <div class="shop-item" style="display: block; margin-top: 20px;">
                        <h4 style="color: #DAA520;">ğŸ“š Documentation</h4>
                        <p>Pour plus d'informations, consultez:</p>
                        <ul style="font-size: 0.9em; color: #ddd; text-align: left;">
                            <li>server/README.md - Guide de dÃ©marrage du serveur</li>
                            <li>MULTIPLAYER_GUIDE.md - Guide du multijoueur LAN</li>
                        </ul>
                    </div>
                </div>
                <div class="game-actions">
                    <button onclick="showAdminPanel()">ğŸšª Retour (ESC)</button>
                    <button onclick="showMultiplayerSettings()">ğŸŒ ParamÃ¨tres Multijoueur</button>
                </div>
            </div>

            <!-- Victory Screen -->
            <div id="victoryScreen" class="game-screen">
                <div class="story-text">
                    <h2 style="color: #DAA520; text-align: center; margin-bottom: 20px;">ğŸ† Victoire ! ğŸ†</h2>
                    <p>AprÃ¨s d'innombrables batailles, vous avez atteint le coeur du donjon !</p>
                    <p>Le Coeur du Dragon brille d'une lumiÃ¨re mystique devant vous. En le touchant, vous sentez son pouvoir ancien couler dans vos veines.</p>
                    <p>Le royaume de Valoria est sauvÃ© grÃ¢ce Ã  votre courage et votre persÃ©vÃ©rance !</p>
                    <p style="text-align: center; margin-top: 30px; font-size: 1.2em; color: #DAA520;">FÃ©licitations, hÃ©ros lÃ©gendaire !</p>
                </div>
                <div class="game-actions">
                    <button onclick="resetGame()">ğŸ”„ Nouvelle Aventure</button>
                </div>
            </div>
        </div>

        <div class="game-footer">
            <span>Le Coeur du Dragon - Un jeu inspirÃ© par Legend of the Red Dragon</span>
            <div style="display: flex; gap: 15px; align-items: center;">
                <span class="save-indicator" id="saveIndicator">ğŸ’¾ SauvegardÃ©</span>
                <button onclick="showAdminLogin()" style="padding: 5px 10px; font-size: 0.9em;">ğŸ” Admin</button>
            </div>
        </div>
    </div>

    <script type="module" src="js/main.js"></script>
    
    <!-- Fallback script to detect module loading failures -->
    <script>
        (function() {
            // Configuration
            const GITHUB_PAGES_URL = 'https://simondesjardinshogue.github.io/lecoeurdudonjon/';
            const MODULE_LOAD_TIMEOUT = 2000; // 2 seconds to allow for slower connections
            
            // Flag to track if modules loaded successfully
            let modulesLoaded = false;
            
            // Listen for successful module load (main.js will set this)
            window.addEventListener('modulesReady', function() {
                modulesLoaded = true;
            });
            
            // Check if modules loaded successfully
            window.addEventListener('load', function() {
                setTimeout(function() {
                    // Check if the startGame function exists (exposed by main.js)
                    if (typeof window.startGame === 'undefined' && !modulesLoaded) {
                        showModuleError();
                    }
                }, MODULE_LOAD_TIMEOUT);
            });
            
            function showModuleError() {
                const errorDiv = document.createElement('div');
                errorDiv.className = 'module-error-dialog';
                errorDiv.innerHTML = `
                    <h2>âš ï¸ Erreur de Chargement</h2>
                    <p><strong>Le jeu ne peut pas se charger correctement.</strong></p>
                    <p>Vous essayez probablement d'ouvrir le fichier directement dans votre navigateur (protocole file://).</p>
                    <h3 style="color: #DAA520; margin-top: 20px;">Solutions:</h3>
                    <ol>
                        <li><strong>Option 1 - Jouer en ligne:</strong><br>
                            Visitez <a href="${GITHUB_PAGES_URL}" target="_blank">${GITHUB_PAGES_URL}</a>
                        </li>
                        <li><strong>Option 2 - Serveur local:</strong><br>
                            Ouvrez un terminal dans le dossier du jeu et lancez:<br>
                            <code>python3 -m http.server 8000</code><br>
                            Puis visitez <a href="http://localhost:8000/">http://localhost:8000/</a>
                        </li>
                        <li><strong>Option 3 - Extension navigateur:</strong><br>
                            Installez une extension comme "Live Server" (VS Code) ou "Web Server for Chrome"
                        </li>
                    </ol>
                    <p style="margin-top: 20px; font-size: 0.9em; color: #aaa;">
                        <em>Note technique: Le jeu utilise des modules ES6 JavaScript qui nÃ©cessitent un serveur HTTP pour des raisons de sÃ©curitÃ© (CORS).</em>
                    </p>
                    <button onclick="this.parentElement.remove()">
                        Fermer ce message
                    </button>
                `;
                document.body.appendChild(errorDiv);
            }
        })();
    </script>
</body>
</html>
