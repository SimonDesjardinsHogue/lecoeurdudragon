<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Le Coeur du Dragon</title>
    <link rel="stylesheet" href="style.css">
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#8B4513">
    <meta name="description" content="Une quÃªte lÃ©gendaire de courage et d'honneur inspirÃ©e par Legend of the Red Dragon">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="Coeur du Dragon">
</head>
<body>
    <div class="game-container">
        <div class="game-header">
            <h1>âš”ï¸ Le Coeur du Dragon âš”ï¸</h1>
            <div class="subtitle">Une quÃªte lÃ©gendaire de courage et d'honneur</div>
            <button id="audioToggle" class="audio-toggle" onclick="toggleAudio()" title="Activer/DÃ©sactiver le son">
                ğŸ”Š
            </button>
        </div>

        <div class="game-stats" id="gameStats" style="display: none;">
            <!-- Groupe 1: Informations personnelles (Nom, Classe, Race, Sexe) -->
            <div class="stat-box stat-group-character">
                <div class="stat-label">Personnage</div>
                <div class="character-info">
                    <div class="char-info-line">
                        <span class="char-info-label">Nom:</span>
                        <span class="stat-value" id="playerName">---</span>
                    </div>
                    <div class="char-info-line">
                        <span class="char-info-label">Classe:</span>
                        <span class="stat-value" id="playerClass">âš”ï¸ Guerrier</span>
                    </div>
                    <div class="char-info-line">
                        <span class="char-info-label">Race:</span>
                        <span class="stat-value" id="playerRace">ğŸ‘¤ Humain</span>
                    </div>
                    <div class="char-info-line">
                        <span class="char-info-label">Sexe:</span>
                        <span class="stat-value" id="playerGender">â™‚ï¸ Masculin</span>
                    </div>
                </div>
            </div>

            <!-- Groupe 2: Statistiques de combat (PV, CA, Ã‰nergie) -->
            <div class="stat-box stat-group-combat">
                <div class="stat-label">Combat</div>
                <div class="combat-stats">
                    <div class="combat-stat-item">
                        <div class="combat-icon">â¤ï¸</div>
                        <div class="combat-stat-content">
                            <div class="combat-stat-label">Points de vie</div>
                            <div class="stat-value" id="playerHealth">100/100</div>
                            <div class="health-bar">
                                <div class="health-fill" id="healthFill" style="width: 100%;"></div>
                            </div>
                        </div>
                    </div>
                    <div class="combat-stat-item">
                        <div class="combat-icon">ğŸ›¡ï¸</div>
                        <div class="combat-stat-content">
                            <div class="combat-stat-label">Classe d'armure</div>
                            <div class="stat-value" id="playerDefense">5</div>
                        </div>
                    </div>
                    <div class="combat-stat-item">
                        <div class="combat-icon">âš¡</div>
                        <div class="combat-stat-content">
                            <div class="combat-stat-label">Ã‰nergie</div>
                            <div class="stat-value" id="playerEnergy">100/100</div>
                            <div class="health-bar">
                                <div class="health-fill" id="energyFill" style="width: 100%; background: linear-gradient(90deg, #FFD700 0%, #FFA500 100%);"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Groupe 3: Progression (Niveau, ExpÃ©rience et Or) -->
            <div class="stat-box stat-group-progression">
                <div class="stat-label">Progression</div>
                <div class="progression-stats">
                    <div class="progression-item">
                        <span class="progression-label">Niveau</span>
                        <span class="stat-value" id="playerLevel">1</span>
                    </div>
                    <div class="progression-item">
                        <span class="progression-label">ExpÃ©rience</span>
                        <span class="stat-value" id="playerXP">0/100</span>
                    </div>
                    <div class="xp-bar">
                        <div class="xp-fill" id="xpFill" style="width: 0%;"></div>
                    </div>
                    <div class="progression-item" style="margin-top: 10px;">
                        <span class="progression-label">Or</span>
                        <span class="stat-value" id="playerGold">0 ğŸ’°</span>
                    </div>
                </div>
            </div>

            <!-- CaractÃ©ristiques -->
            <div class="stat-box characteristics-group">
                <div class="stat-label">CaractÃ©ristiques</div>
                <div class="characteristics-grid">
                    <div class="characteristic">
                        <span class="char-label">FOR</span>
                        <span class="char-value" id="playerStrength">10</span>
                    </div>
                    <div class="characteristic">
                        <span class="char-label">DEX</span>
                        <span class="char-value" id="playerDexterity">10</span>
                    </div>
                    <div class="characteristic">
                        <span class="char-label">CON</span>
                        <span class="char-value" id="playerConstitution">10</span>
                    </div>
                    <div class="characteristic">
                        <span class="char-label">INT</span>
                        <span class="char-value" id="playerIntelligence">10</span>
                    </div>
                    <div class="characteristic">
                        <span class="char-label">SAG</span>
                        <span class="char-value" id="playerWisdom">10</span>
                    </div>
                    <div class="characteristic">
                        <span class="char-label">CHA</span>
                        <span class="char-value" id="playerCharisma">10</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="game-content">
            <!-- Start Screen -->
            <div id="startScreen" class="game-screen active">
                <div class="story-text">
                    <p>Bienvenue, brave aventurier !</p>
                    <p>Dans le royaume oubliÃ© de Valoria, les tÃ©nÃ¨bres s'Ã©tendent. Au coeur du donjon ancien se cache un artefact lÃ©gendaire - le Coeur du Dragon - capable de sauver le royaume.</p>
                    <p>Les lÃ©gendes racontent que seul un hÃ©ros courageux peut affronter les dangers qui gardent ce trÃ©sor mystique...</p>
                    <p>ÃŠtes-vous prÃªt Ã  devenir cette lÃ©gende ?</p>
                </div>
                <div>
                    <label for="nameInput" style="display: block; margin-bottom: 10px;">Entrez votre nom :</label>
                    <input type="text" id="nameInput" placeholder="Nom du hÃ©ros" maxlength="20">
                </div>
                <div style="margin: 20px 0;">
                    <label style="display: block; margin-bottom: 10px; font-weight: bold;">Genre :</label>
                    <div style="display: flex; gap: 20px;">
                        <label class="class-option" style="flex: 1;">
                            <input type="radio" name="characterGender" value="male" checked>
                            <span class="class-label">
                                <strong>â™‚ï¸ Masculin</strong>
                            </span>
                        </label>
                        <label class="class-option" style="flex: 1;">
                            <input type="radio" name="characterGender" value="female">
                            <span class="class-label">
                                <strong>â™€ï¸ FÃ©minin</strong>
                            </span>
                        </label>
                    </div>
                </div>
                <div style="margin: 20px 0;">
                    <label style="display: block; margin-bottom: 10px; font-weight: bold;">Race :</label>
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px;">
                        <label class="class-option">
                            <input type="radio" name="characterRace" value="humain" checked>
                            <span class="class-label">
                                <strong>ğŸ‘¤ Humain</strong><br>
                                <small style="color: #999;">Ã‰quilibrÃ©</small>
                            </span>
                        </label>
                        <label class="class-option">
                            <input type="radio" name="characterRace" value="elfe">
                            <span class="class-label">
                                <strong>ğŸ§ Elfe</strong><br>
                                <small>DEX +2, CON -2</small>
                            </span>
                        </label>
                        <label class="class-option">
                            <input type="radio" name="characterRace" value="nain">
                            <span class="class-label">
                                <strong>ğŸ§” Nain</strong><br>
                                <small>DEX -2, CON +2</small>
                            </span>
                        </label>
                    </div>
                </div>
                <div style="margin: 20px 0;">
                    <label style="display: block; margin-bottom: 10px; font-weight: bold;">Choisissez votre classe :</label>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                        <label class="class-option">
                            <input type="radio" name="characterClass" value="guerrier" checked>
                            <span class="class-label">
                                <strong>âš”ï¸ Guerrier</strong><br>
                                <small>PV: 120 | FOR: 12 | CA: 8</small><br>
                                <small style="color: #999;">Robuste et rÃ©sistant</small>
                            </span>
                        </label>
                        <label class="class-option">
                            <input type="radio" name="characterClass" value="magicien">
                            <span class="class-label">
                                <strong>ğŸ§™ Magicien</strong><br>
                                <small>PV: 80 | FOR: 15 | CA: 3</small><br>
                                <small style="color: #999;">Puissant mais fragile</small>
                            </span>
                        </label>
                        <label class="class-option">
                            <input type="radio" name="characterClass" value="archer">
                            <span class="class-label">
                                <strong>ğŸ¹ Archer</strong><br>
                                <small>PV: 100 | FOR: 13 | CA: 5</small><br>
                                <small style="color: #999;">Ã‰quilibrÃ© et prÃ©cis</small>
                            </span>
                        </label>
                        <label class="class-option">
                            <input type="radio" name="characterClass" value="rogue">
                            <span class="class-label">
                                <strong>ğŸ—¡ï¸ Rogue</strong><br>
                                <small>PV: 90 | FOR: 14 | CA: 4</small><br>
                                <small style="color: #999;">Agile et furtif</small>
                            </span>
                        </label>
                    </div>
                </div>
                <div class="game-actions">
                    <button onclick="startGame()">ğŸ—¡ï¸ Commencer l'Aventure</button>
                    <button onclick="restoreSaveFromStart()" id="restoreSaveBtn" style="display: none;">ğŸ“¥ Restaurer une Partie</button>
                </div>
            </div>

            <!-- Main Game Screen -->
            <div id="mainScreen" class="game-screen">
                <div class="story-text">
                    <p>Vous vous tenez devant l'entrÃ©e du donjon. Les torches vacillent sur les murs de pierre ancienne. Que souhaitez-vous faire ?</p>
                </div>
                <div class="game-actions-grid">
                    <div class="actions-column">
                        <div class="actions-column-title">ğŸ® Actions de Jeu</div>
                        <button onclick="explore()">ğŸ—ºï¸ Explorer le Donjon (1)</button>
                        <button onclick="meetNPC()">ğŸ’¬ Rencontrer un PNJ (2)</button>
                        <button onclick="showShop()">ğŸª Visiter le Marchand (3)</button>
                        <button onclick="rest()">ğŸ›Œ Dormir Ã  l'Auberge (4)</button>
                    </div>
                    <div class="actions-column">
                        <div class="actions-column-title">ğŸ“Š Informations</div>
                        <button onclick="showStats()">ğŸ“Š Voir Statistiques (5)</button>
                        <button onclick="showLeaderboard()">ğŸ† Classement (6)</button>
                        <button onclick="showDailyQuests()">ğŸ“œ DÃ©fis Quotidiens (7)</button>
                        <button onclick="showAchievements()">ğŸ… SuccÃ¨s (8)</button>
                    </div>
                </div>
            </div>

            <!-- Combat Screen -->
            <div id="combatScreen" class="game-screen">
                <div class="enemy-info" id="enemyInfo">
                    <h3 id="enemyName">Ennemi</h3>
                    <div class="stat-value" id="enemyHealth">HP: 50/50</div>
                    <div class="health-bar">
                        <div class="health-fill" id="enemyHealthFill" style="width: 100%;"></div>
                    </div>
                </div>
                <div class="combat-log" id="combatLog"></div>
                <div id="skillsContainer" style="margin: 15px 0;"></div>
                <div class="game-actions">
                    <button onclick="attack()">âš”ï¸ Attaquer (A)</button>
                    <button onclick="defend()">ğŸ›¡ï¸ DÃ©fendre (D)</button>
                    <button onclick="flee()">ğŸƒ Fuir (F)</button>
                </div>
            </div>

            <!-- Shop Screen -->
            <div id="shopScreen" class="game-screen">
                <div class="story-text">
                    <p>Un vieux marchand vous accueille avec un sourire Ã©dentÃ©. "Bienvenue dans ma modeste Ã©choppe ! Jetez un oeil Ã  mes marchandises..."</p>
                </div>
                <div id="shopItems"></div>
                <div class="game-actions">
                    <button onclick="showMain()">ğŸšª Retour (ESC)</button>
                </div>
            </div>

            <!-- Stats Screen -->
            <div id="statsScreen" class="game-screen">
                <div class="story-text">
                    <h3>ğŸ“Š Statistiques du HÃ©ros</h3>
                    <div id="detailedStats"></div>
                </div>
                <div class="game-actions">
                    <button onclick="showMain()">ğŸšª Retour (ESC)</button>
                    <button onclick="showSaveOptions()">ğŸ’¾ Sauvegardes</button>
                    <button onclick="resetGame()" style="background: linear-gradient(135deg, #8B0000 0%, #660000 100%);">ğŸ”„ Nouvelle Partie</button>
                </div>
            </div>

            <!-- Save Options Screen -->
            <div id="saveOptionsScreen" class="game-screen">
                <div class="story-text">
                    <h3>ğŸ’¾ Gestion des Sauvegardes</h3>
                    <p>Votre partie est automatiquement sauvegardÃ©e dans votre navigateur. Utilisez les options ci-dessous pour gÃ©rer vos sauvegardes :</p>
                    
                    <div class="shop-item" style="display: block; margin-top: 20px;">
                        <h4 style="color: #DAA520;">ğŸ“¤ Exporter la Sauvegarde</h4>
                        <p>Obtenez un code de sauvegarde que vous pouvez copier et utiliser sur n'importe quel appareil.</p>
                        <button onclick="exportSave()" style="margin-top: 10px;">GÃ©nÃ©rer le Code</button>
                        <div id="exportResult" style="margin-top: 10px;"></div>
                    </div>
                    
                    <div class="shop-item" style="display: block; margin-top: 20px;">
                        <h4 style="color: #DAA520;">ğŸ“¥ Importer une Sauvegarde</h4>
                        <p>Entrez un code de sauvegarde pour restaurer votre progression.</p>
                        <input type="text" id="importCode" placeholder="Collez votre code ici" style="width: 100%; max-width: 100%;">
                        <button onclick="importSave()" style="margin-top: 10px;">Restaurer</button>
                        <div id="importResult" style="margin-top: 10px;"></div>
                    </div>
                    
                    <div class="shop-item" style="display: block; margin-top: 20px;">
                        <h4 style="color: #DAA520;">â˜ï¸ Sauvegarde Automatique</h4>
                        <p>Statut: <span id="autoSaveStatus" style="color: #51cf66;">âœ“ Active</span></p>
                        <p style="font-size: 0.9em; color: #999;">Les sauvegardes sont automatiquement enregistrÃ©es dans votre navigateur aprÃ¨s chaque action.</p>
                    </div>
                </div>
                <div class="game-actions">
                    <button onclick="showStats()">ğŸšª Retour (ESC)</button>
                </div>
            </div>

            <!-- NPC Screen -->
            <div id="npcScreen" class="game-screen">
                <div class="story-text">
                    <h3 id="npcName">PNJ</h3>
                    <div id="npcDialogue"></div>
                </div>
                <div class="game-actions">
                    <button onclick="showMain()">ğŸšª Retour (ESC)</button>
                </div>
            </div>

            <!-- Leaderboard Screen -->
            <div id="leaderboardScreen" class="game-screen">
                <div class="story-text">
                    <h3>ğŸ† Classement des HÃ©ros</h3>
                    <p>Les plus grands hÃ©ros du royaume de Valoria :</p>
                    <div id="leaderboardList"></div>
                </div>
                <div class="game-actions">
                    <button onclick="showMain()">ğŸšª Retour (ESC)</button>
                </div>
            </div>

            <!-- Achievements Screen -->
            <div id="achievementsScreen" class="game-screen">
                <div class="story-text">
                    <h3>ğŸ… SuccÃ¨s et Accomplissements</h3>
                    <p>DÃ©bloquez des succÃ¨s pour gagner des rÃ©compenses permanentes !</p>
                    <div id="achievementsContainer" style="max-height: 500px; overflow-y: auto;"></div>
                </div>
                <div class="game-actions">
                    <button onclick="showMain()">ğŸšª Retour (ESC)</button>
                </div>
            </div>

            <!-- Victory Screen -->
            <div id="victoryScreen" class="game-screen">
                <div class="story-text">
                    <h2 style="color: #DAA520; text-align: center; margin-bottom: 20px;">ğŸ† Victoire ! ğŸ†</h2>
                    <p>AprÃ¨s d'innombrables batailles, vous avez atteint le coeur du donjon !</p>
                    <p>Le Coeur du Dragon brille d'une lumiÃ¨re mystique devant vous. En le touchant, vous sentez son pouvoir ancien couler dans vos veines.</p>
                    <p>Le royaume de Valoria est sauvÃ© grÃ¢ce Ã  votre courage et votre persÃ©vÃ©rance !</p>
                    <p style="text-align: center; margin-top: 30px; font-size: 1.2em; color: #DAA520;">FÃ©licitations, hÃ©ros lÃ©gendaire !</p>
                </div>
                <div class="game-actions">
                    <button onclick="resetGame()">ğŸ”„ Nouvelle Aventure</button>
                </div>
            </div>
        </div>

        <div class="game-footer">
            <span>Le Coeur du Dragon - Un jeu inspirÃ© par Legend of the Red Dragon</span>
            <span class="save-indicator" id="saveIndicator">ğŸ’¾ SauvegardÃ©</span>
        </div>
    </div>

    <script type="module" src="js/main.js"></script>
    
    <!-- Fallback script to detect module loading failures -->
    <script>
        (function() {
            // Configuration
            const GITHUB_PAGES_URL = 'https://simondesjardinshogue.github.io/lecoeurdudonjon/';
            const MODULE_LOAD_TIMEOUT = 2000; // 2 seconds to allow for slower connections
            
            // Flag to track if modules loaded successfully
            let modulesLoaded = false;
            
            // Listen for successful module load (main.js will set this)
            window.addEventListener('modulesReady', function() {
                modulesLoaded = true;
            });
            
            // Check if modules loaded successfully
            window.addEventListener('load', function() {
                setTimeout(function() {
                    // Check if the startGame function exists (exposed by main.js)
                    if (typeof window.startGame === 'undefined' && !modulesLoaded) {
                        showModuleError();
                    }
                }, MODULE_LOAD_TIMEOUT);
            });
            
            function showModuleError() {
                const errorDiv = document.createElement('div');
                errorDiv.className = 'module-error-dialog';
                errorDiv.innerHTML = `
                    <h2>âš ï¸ Erreur de Chargement</h2>
                    <p><strong>Le jeu ne peut pas se charger correctement.</strong></p>
                    <p>Vous essayez probablement d'ouvrir le fichier directement dans votre navigateur (protocole file://).</p>
                    <h3 style="color: #DAA520; margin-top: 20px;">Solutions:</h3>
                    <ol>
                        <li><strong>Option 1 - Jouer en ligne:</strong><br>
                            Visitez <a href="${GITHUB_PAGES_URL}" target="_blank">${GITHUB_PAGES_URL}</a>
                        </li>
                        <li><strong>Option 2 - Serveur local:</strong><br>
                            Ouvrez un terminal dans le dossier du jeu et lancez:<br>
                            <code>python3 -m http.server 8000</code><br>
                            Puis visitez <a href="http://localhost:8000/">http://localhost:8000/</a>
                        </li>
                        <li><strong>Option 3 - Extension navigateur:</strong><br>
                            Installez une extension comme "Live Server" (VS Code) ou "Web Server for Chrome"
                        </li>
                    </ol>
                    <p style="margin-top: 20px; font-size: 0.9em; color: #aaa;">
                        <em>Note technique: Le jeu utilise des modules ES6 JavaScript qui nÃ©cessitent un serveur HTTP pour des raisons de sÃ©curitÃ© (CORS).</em>
                    </p>
                    <button onclick="this.parentElement.remove()">
                        Fermer ce message
                    </button>
                `;
                document.body.appendChild(errorDiv);
            }
        })();
    </script>
</body>
</html>
